<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}  
    <!--Metadatos-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}DreamWorks{% endblock %}</title>

    <!--Bootstrap, Css y Favicon-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/css/pelicula.css' %}">
    <link rel="stylesheet" href="/static/core/css/styles.css?v=1.4">
    <link rel="icon" href="{% static 'core/img/dreamworks-moon.gif' %}" type="image/gif">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    
    <!-- Estilos inline cr√≠ticos -->
    <style>
    /* OCULTAR TODOS LOS ERRORES DE FORMULARIOS */
    .errorlist {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        opacity: 0 !important;
    }
    
    /* Remover clases de error de los campos */
    .error {
        border-color: initial !important;
        background-color: initial !important;
    }
</style>
    <style>
        /* ESTILOS FORZADOS PARA SOBREESCRIBIR BOOTSTRAP */
        .dreamworks-main {
            font-family: 'UnifrakturMaguntia', cursive !important;
            font-size: 8rem !important;
            position: relative !important;
            z-index: 5 !important;
            width: 100% !important;
            margin: 4rem auto !important;
            padding: 3rem !important;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
            border-radius: 15px !important;
            color: #f7ec20 !important;
            text-align: center !important;
            box-shadow: 0 0 30px rgba(247, 236, 32, 0.3) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            min-height: 250px !important;
            border: 2px solid #f7ec20 !important;
        }
        
        .dreamworks-main h1 {
            font-size: 4.5rem !important;
            text-shadow: 0 0 10px #bdaa3ee8, 0 0 20px #f7ec20, 0 0 30px #f7ec20 !important;
            margin: 0 !important;
            letter-spacing: 3px !important;
            font-weight: normal !important;
            line-height: 1.2 !important;
        }
        
        /* Asegurar que los formularios est√©n ocultos inicialmente */
        .formulario-registro,
        .formulario-login {
            display: none !important;
        }

        /* ESTILOS MEJORADOS PARA MENSAJES */
        .alert-medieval {
            font-family: 'MedievalSharp', cursive !important;
            border: 2px solid #8b4513;
            border-radius: 8px;
            background: linear-gradient(135deg, #f5e7c1, #e6d6a8);
            color: #5c3317;
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        
        .alert-medieval.alert-danger {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border-color: #c62828;
            color: #b71c1c;
        }
        
        .alert-medieval.alert-success {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-color: #2e7d32;
            color: #1b5e20;
        }
        
        .alert-medieval.alert-warning {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-color: #ff8f00;
            color: #e65100;
        }
        
        .alert-medieval.alert-info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #1565c0;
            color: #0d47a1;
        }
        
        .medieval-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        .btn-close-medieval {
            opacity: 0.7;
            color: inherit;
        }
        
        .btn-close-medieval:hover {
            opacity: 1;
        }

        /* Posicionamiento fijo para mensajes */
        .messages-fixed-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            width: 350px;
        }
    </style>
    <style>
    /* 1. Transici√≥n suave en todo el documento */
    html {
      scroll-behavior: smooth;
    }
    /* 2. Cuando saltes a #paginacion-pelicula, deja 100px por encima */
    #paginacion-pelicula {
      scroll-margin-top: 100px; /* ajusta al alto de tu header */
    }
  </style>

    
</head>
<body>


    {% include 'partials/header.html' %}
    
    <!-- Contenedor de mensajes flotantes -->
    <div class="messages-fixed-container">
        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show alert-medieval" role="alert">
                <div class="d-flex align-items-center">
                    <span class="medieval-icon">
                        {% if message.tags == 'error' or message.tags == 'danger' %}‚öîÔ∏è
                        {% elif message.tags == 'success' %}‚ú®
                        {% elif message.tags == 'warning' %}üõ°Ô∏è
                        {% else %}üìú{% endif %}
                    </span>
                    <span>{{ message }}</span>
                </div>
                <button type="button" class="btn-close btn-close-medieval" data-bs-dismiss="alert" aria-label="Cerrar"></button>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <main>
    <div class="messages-fixed-container">
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show alert-medieval" role="alert">
            <div class="d-flex align-items-center">
                <span class="medieval-icon">
                    {% if message.tags == 'error' %}‚öîÔ∏è
                    {% elif message.tags == 'success' %}‚ú®
                    {% elif message.tags == 'warning' %}üõ°Ô∏è
                    {% else %}üìú{% endif %}
                </span>
                <span>{{ message }}</span>
            </div>
            <button type="button" class="btn-close btn-close-medieval" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        {% endfor %}
    {% endif %}
</div>
    

    {% block content %}
    {% endblock %}
</main>
    {% block contenido %}{% endblock %}


    <!-- Footer -->
    {% include 'partials/modals.html' %}
    {% if request.path == '/registro/' %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.querySelector('.formulario-registro');
    if (modal) modal.style.display = 'block';
});
</script>
{% elif request.path == '/login/' %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.querySelector('.formulario-login');
    if (modal) modal.style.display = 'block';
});
</script>
{% endif %}

    {% include 'partials/footer.html' %}


    <!-- Scripts JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para auto-cerrar mensajes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-cerrar alerts despu√©s de 5 segundos
            setTimeout(function() {
                var alerts = document.querySelectorAll('.alert');
                alerts.forEach(function(alert) {
                    var bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                });
            }, 5000);
        });
    </script>

    <!--scripts para contar en las opiniones generales-->
    <script>
  document.addEventListener('DOMContentLoaded', function () {
    const textarea = document.querySelector('#comentarios-flotante textarea');
    const contador = document.querySelector('#chars-left');
    const maxChars = parseInt(textarea.getAttribute('maxlength'));

    if (textarea && contador) {
      textarea.addEventListener('input', function () {
        const restantes = maxChars - textarea.value.length;
        contador.textContent = restantes;

        // Efecto visual suave
        if (restantes <= 10) {
          contador.style.color = '#ff6b6b'; // rojo suave
        } else {
          contador.style.color = '#fcf159'; // tu color original
        }
      });
    }
  });
</script>
<script>
// En tu base.html, agrega este script para remover errores
document.addEventListener('DOMContentLoaded', function() {
    // Eliminar todos los errores de formulario
    const errorLists = document.querySelectorAll('.errorlist');
    errorLists.forEach(function(errorList) {
        errorList.remove();
    });
    
    // Remover clases de error de los campos
    const errorInputs = document.querySelectorAll('.error');
    errorInputs.forEach(function(input) {
        input.classList.remove('error');
    });
});
</script>

    <!-- Script para animaciones de fondo -->
    <script>
        
    // Funci√≥n para mostrar/ocultar informaci√≥n de pel√≠culas
    function mostrarContenido(id) {
        const todosInfos = document.querySelectorAll('.pelicula-info');
        todosInfos.forEach(info => {
            info.classList.remove('activo');
        });
        
        const info = document.getElementById(id);
        if (info) {
            info.classList.add('activo');
        }
    }

    // Cerrar los detalles de pel√≠culas al hacer clic fuera
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.pelicula-card')) {
            const todosInfos = document.querySelectorAll('.pelicula-info');
            todosInfos.forEach(info => {
                info.classList.remove('activo');
            });
        }
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let modal = null;
    let triggerBtn = null;

    const modalRegistro = document.getElementById('formulario-registro');
    const modalLogin = document.getElementById('formulario-login');
    const btnRegistro = document.querySelector('a[href$="/registro/"]');
    const btnLogin = document.querySelector('a[href$="/login/"]');

    // Detectar modal seg√∫n URL
    if (window.location.pathname.includes('/registro')) {
        modal = modalRegistro;
        triggerBtn = btnRegistro;
    } else if (window.location.pathname.includes('/login')) {
        modal = modalLogin;
        triggerBtn = btnLogin;
    }

    // Abrir modal
    function abrirModal(m) {
        m.classList.add('is-open');
    }

    // Cerrar modal y limpiar URL
    function cerrarModal(m) {
        m.classList.remove('is-open');
        window.history.pushState({}, '', '/');
    }

    // Abrir al cargar
    if (modal) {
        abrirModal(modal);
    }

    // Cerrar al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (modal && modal.classList.contains('is-open')) {
            if (!modal.contains(e.target) && e.target !== triggerBtn) {
                cerrarModal(modal);
            }
        }
    });

    // Cerrar si se hace clic en el mismo bot√≥n
    if (triggerBtn) {
        triggerBtn.addEventListener('click', function(e) {
            if (modal && modal.classList.contains('is-open')) {
                e.preventDefault();
                cerrarModal(modal);
            }
        });
    }
});
</script>
<script>
  setTimeout(() => {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) mensaje.style.display = 'none';
  }, 5000); // desaparece despu√©s de 5 segundos
</script>

<!-- aqu√≠ va el script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) {
      setTimeout(() => {
        mensaje.style.opacity = '0';
        setTimeout(() => mensaje.remove(), 500);
      }, 5000);
    }

    {% if request.session.abrir_login %}
      if (!sessionStorage.getItem('abrir_login_mostrado')) {
        const modal = document.getElementById('formulario-login');
        if (modal) modal.classList.add('is-open');
        sessionStorage.setItem('abrir_login_mostrado', 'true');
      }
    {% endif %}
  });
</script>

<!-- aqu√≠ va el script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) {
      setTimeout(() => {
        mensaje.style.opacity = '0';
        setTimeout(() => mensaje.remove(), 500);
      }, 5000);
    }

    {% if request.session.abrir_login %}
      if (!sessionStorage.getItem('abrir_login_mostrado')) {
        const modal = document.getElementById('formulario-login');
        if (modal) modal.classList.add('is-open');
        sessionStorage.setItem('abrir_login_mostrado', 'true');
      }
    {% endif %}
  });
</script>
    <script>
  /**
   * smoothScrollTo: anima el scroll desde startY hasta targetY
   * con una funci√≥n de easing "easeInOutQuad".
   */
  function smoothScrollTo(startY, targetY, duration = 600) {
    let startTime = null;
    function easeInOutQuad(t) {
      return t < 0.5
        ? 2 * t * t
        : -1 + (4 - 2 * t) * t;
    }
    function animate(time) {
      if (startTime === null) startTime = time;
      const elapsed = time - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = easeInOutQuad(progress);
      window.scrollTo(
        0,
        startY + (targetY - startY) * eased
      );
      if (elapsed < duration) {
        requestAnimationFrame(animate);
      }
    }
    requestAnimationFrame(animate);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(location.search);
    if (!params.has('page')) return;

    const pag = document.getElementById('paginacion-pelicula');
    if (!pag) return;

    // Calcula la posici√≥n destino: altura real de la paginaci√≥n
    const header = document.querySelector('header');
    const headerH = header ? header.offsetHeight : 0;
    const margin   = 20; // espacio extra
    const targetY  = pag.getBoundingClientRect().top
                     + window.pageYOffset
                     - headerH
                     - margin;
    const startY   = window.pageYOffset;

    // Lanza la animaci√≥n
    smoothScrollTo(startY, targetY, 600);
  });
</script>

    {% block extra_js %}
    {% endblock %}
</body>
</html>