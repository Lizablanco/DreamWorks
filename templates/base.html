<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}  
    <!--Metadatos-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}DreamWorks{% endblock %}</title>

    <!--Bootstrap, Css y Favicon-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/css/pelicula.css' %}">
    <link rel="stylesheet" href="/static/core/css/styles.css?v=1.4">
    <link rel="icon" href="{% static 'core/img/dreamworks-moon.gif' %}" type="image/gif">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    
    <!-- Estilos inline críticos -->
    <style>
        /* ESTILOS FORZADOS PARA SOBREESCRIBIR BOOTSTRAP */
        .dreamworks-main {
            font-family: 'UnifrakturMaguntia', cursive !important;
            font-size: 8rem !important;
            position: relative !important;
            z-index: 5 !important;
            width: 100% !important;
            margin: 4rem auto !important;
            padding: 3rem !important;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
            border-radius: 15px !important;
            color: #f7ec20 !important;
            text-align: center !important;
            box-shadow: 0 0 30px rgba(247, 236, 32, 0.3) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            min-height: 250px !important;
            border: 2px solid #f7ec20 !important;
        }
        
        .dreamworks-main h1 {
            font-size: 4.5rem !important;
            text-shadow: 0 0 10px #bdaa3ee8, 0 0 20px #f7ec20, 0 0 30px #f7ec20 !important;
            margin: 0 !important;
            letter-spacing: 3px !important;
            font-weight: normal !important;
            line-height: 1.2 !important;
        }
        
        /* Asegurar que los formularios estén ocultos inicialmente */
        .formulario-registro,
        .formulario-login {
            display: none !important;
        }
    </style>
    <style>
    /* 1. Transición suave en todo el documento */
    html {
      scroll-behavior: smooth;
    }
    /* 2. Cuando saltes a #paginacion-pelicula, deja 100px por encima */
    #paginacion-pelicula {
      scroll-margin-top: 100px; /* ajusta al alto de tu header */
    }
  </style>

    
</head>
<body>


    {% include 'partials/header.html' %}
    
    <main>
    <div class="container mt-3">
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
        {% endfor %}
    {% endif %}
    </div>
    

    {% block content %}
    {% endblock %}
</main>
    {% block contenido %}{% endblock %}


    <!-- Footer -->
    {% include 'partials/modals.html' %}
    {% if request.path == '/registro/' %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.querySelector('.formulario-registro');
    if (modal) modal.style.display = 'block';
});
</script>
{% elif request.path == '/login/' %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.querySelector('.formulario-login');
    if (modal) modal.style.display = 'block';
});
</script>
{% endif %}

    {% include 'partials/footer.html' %}


    <!-- Scripts JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!--scripts para contar en las opiniones generales-->
    <script>
  document.addEventListener('DOMContentLoaded', function () {
    const textarea = document.querySelector('#comentarios-flotante textarea');
    const contador = document.querySelector('#chars-left');
    const maxChars = parseInt(textarea.getAttribute('maxlength'));

    if (textarea && contador) {
      textarea.addEventListener('input', function () {
        const restantes = maxChars - textarea.value.length;
        contador.textContent = restantes;

        // Efecto visual suave
        if (restantes <= 10) {
          contador.style.color = '#ff6b6b'; // rojo suave
        } else {
          contador.style.color = '#fcf159'; // tu color original
        }
      });
    }
  });
</script>


    <!-- Script para animaciones de fondo -->
    <script>
        
    // Función para mostrar/ocultar información de películas
    function mostrarContenido(id) {
        const todosInfos = document.querySelectorAll('.pelicula-info');
        todosInfos.forEach(info => {
            info.classList.remove('activo');
        });
        
        const info = document.getElementById(id);
        if (info) {
            info.classList.add('activo');
        }
    }

    // Cerrar los detalles de películas al hacer clic fuera
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.pelicula-card')) {
            const todosInfos = document.querySelectorAll('.pelicula-info');
            todosInfos.forEach(info => {
                info.classList.remove('activo');
            });
        }
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let modal = null;
    let triggerBtn = null;

    const modalRegistro = document.getElementById('formulario-registro');
    const modalLogin = document.getElementById('formulario-login');
    const btnRegistro = document.querySelector('a[href$="/registro/"]');
    const btnLogin = document.querySelector('a[href$="/login/"]');

    // Detectar modal según URL
    if (window.location.pathname.includes('/registro')) {
        modal = modalRegistro;
        triggerBtn = btnRegistro;
    } else if (window.location.pathname.includes('/login')) {
        modal = modalLogin;
        triggerBtn = btnLogin;
    }

    // Abrir modal
    function abrirModal(m) {
        m.classList.add('is-open');
    }

    // Cerrar modal y limpiar URL
    function cerrarModal(m) {
        m.classList.remove('is-open');
        window.history.pushState({}, '', '/');
    }

    // Abrir al cargar
    if (modal) {
        abrirModal(modal);
    }

    // Cerrar al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (modal && modal.classList.contains('is-open')) {
            if (!modal.contains(e.target) && e.target !== triggerBtn) {
                cerrarModal(modal);
            }
        }
    });

    // Cerrar si se hace clic en el mismo botón
    if (triggerBtn) {
        triggerBtn.addEventListener('click', function(e) {
            if (modal && modal.classList.contains('is-open')) {
                e.preventDefault();
                cerrarModal(modal);
            }
        });
    }
});
</script>
<script>
  setTimeout(() => {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) mensaje.style.display = 'none';
  }, 5000); // desaparece después de 5 segundos
</script>

<!-- aquí va el script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) {
      setTimeout(() => {
        mensaje.style.opacity = '0';
        setTimeout(() => mensaje.remove(), 500);
      }, 5000);
    }

    {% if request.session.abrir_login %}
      if (!sessionStorage.getItem('abrir_login_mostrado')) {
        const modal = document.getElementById('formulario-login');
        if (modal) modal.classList.add('is-open');
        sessionStorage.setItem('abrir_login_mostrado', 'true');
      }
    {% endif %}
  });
</script>

<!-- aquí va el script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mensaje = document.querySelector('.mensaje-flotante');
    if (mensaje) {
      setTimeout(() => {
        mensaje.style.opacity = '0';
        setTimeout(() => mensaje.remove(), 500);
      }, 5000);
    }

    {% if request.session.abrir_login %}
      if (!sessionStorage.getItem('abrir_login_mostrado')) {
        const modal = document.getElementById('formulario-login');
        if (modal) modal.classList.add('is-open');
        sessionStorage.setItem('abrir_login_mostrado', 'true');
      }
    {% endif %}
  });
</script>
    <script>
  /**
   * smoothScrollTo: anima el scroll desde startY hasta targetY
   * con una función de easing “easeInOutQuad”.
   */
  function smoothScrollTo(startY, targetY, duration = 600) {
    let startTime = null;
    function easeInOutQuad(t) {
      return t < 0.5
        ? 2 * t * t
        : -1 + (4 - 2 * t) * t;
    }
    function animate(time) {
      if (startTime === null) startTime = time;
      const elapsed = time - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = easeInOutQuad(progress);
      window.scrollTo(
        0,
        startY + (targetY - startY) * eased
      );
      if (elapsed < duration) {
        requestAnimationFrame(animate);
      }
    }
    requestAnimationFrame(animate);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(location.search);
    if (!params.has('page')) return;

    const pag = document.getElementById('paginacion-pelicula');
    if (!pag) return;

    // Calcula la posición destino: altura real de la paginación
    const header = document.querySelector('header');
    const headerH = header ? header.offsetHeight : 0;
    const margin   = 20; // espacio extra
    const targetY  = pag.getBoundingClientRect().top
                     + window.pageYOffset
                     - headerH
                     - margin;
    const startY   = window.pageYOffset;

    // Lanza la animación
    smoothScrollTo(startY, targetY, 600);
  });
</script>

    {% block extra_js %}
    {% endblock %}
</body>
</html>